#!/bin/sh
# see how long the system survived

dev=$(findmnt -n -o SOURCE /) || { echo "cannot find root device"; exit 1; }

# requires sudo for tune2fs on many systems
created_epoch=$(sudo tune2fs -l "$dev" 2>/dev/null \
  | awk -F'Filesystem created:[ \t]*' '/Filesystem created/ {
      cmd = "date -d \""$2"\" +%s"
      cmd | getline t; close(cmd)
      print t; exit
    }')

[ -z "$created_epoch" ] && { echo "cannot read filesystem's creation time"; exit 1; }

now=$(date +%s)
diff=$((now - created_epoch))

days=$((diff / 86400))
diff=$((diff % 86400))
hours=$((diff / 3600))
diff=$((diff % 3600))
mins=$((diff / 60))
secs=$((diff % 60))

printf "Congrats! Your system suivived %d days, %02d:%02d:%02d\n" "$days" "$hours" "$mins" "$secs"
